<?php

return <<<'VALUE'
"namespace IPS\\Theme;\nclass class_cms_database_display\n{\n\tfunction comment( $item, $comment, $editorName, $app, $type, $class='' ) {\n\t\t$return = '';\n\t\t$return .= <<<IPSCONTENT\n\n\nIPSCONTENT;\n\n$itemIdField = $item::$databaseColumnId; $idField = $comment::$databaseColumnId;\n$return .= <<<IPSCONTENT\n\n<div id='comment-\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_wrap' data-controller='core.front.core.comment' data-feedid=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->feedId, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\" data-commentApp='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $app, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-commentType='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $type, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-commentID=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\" data-quoteData='\nIPSCONTENT;\n\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( json_encode( array('userid' => $comment->author()->member_id, 'username' => $comment->author()->name, 'timestamp' => $comment->mapped('date'), 'contentapp' => $app, 'contenttype' => $type, 'contentclass' => $class, 'contentid' => $item->$itemIdField, 'contentcommentid' => $comment->$idField) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' class='ipsEntry__content js-ipsEntry__content \nIPSCONTENT;\n\nif ( $comment->hidden() ):\n$return .= <<<IPSCONTENT\nipsModerated\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n'\n\nIPSCONTENT;\n\nif ( \\IPS\\IPS::classUsesTrait( $comment, 'IPS\\Content\\IntersectionViewTracking' ) AND $hash=$comment->getViewTrackingHash() ):\n$return .= <<<IPSCONTENT\n\ndata-view-hash=\"{$hash}\"\ndata-view-tracking-data=\"\nIPSCONTENT;\n\n$return .= base64_encode(json_encode( $comment->getViewTrackingData() ));\n$return .= <<<IPSCONTENT\n\"\n\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n>\n\t<header class='ipsEntry__header'>\n\t\t<div class='ipsEntry__header-align'>\n\t\t\t<div class='ipsPhotoPanel'>\n\t\t\t\t<div class='ipsAvatarStack'>\n\t\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->userPhoto( $comment->author(), 'fluid', $comment->warningRef() );\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nif ( !$comment->isAnonymous() and $comment->author()->canHaveAchievements() and \\IPS\\core\\Achievements\\Rank::show() and $rank = $comment->author()->rank() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t{$rank->html( 'ipsAvatarStack__rank' )}\n\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\t<div class='ipsPhotoPanel__text'>\n\t\t\t\t\t<div class='ipsEntry__username'>\n\t\t\t\t\t\t<h3>\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->userLink( $comment->author(), $comment->warningRef(), NULL, $comment->isAnonymous() );\n$return .= <<<IPSCONTENT\n<\/h3>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( !$comment->isAnonymous() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t<span class='ipsEntry__group'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member\\Group::load( $comment->author()->member_group_id )->formattedName;\n$return .= <<<IPSCONTENT\n<\/span>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( \\IPS\\IPS::classUsesTrait( $comment, 'IPS\\Content\\Anonymous' ) and $comment->isAnonymous() and \\IPS\\Member::loggedIn()->modPermission('can_view_anonymous_posters') ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t<a data-ipsHover data-ipsHover-width=\"370\" data-ipsHover-onClick href=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->url( 'reveal' )->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\"><span class=\"ipsAnonymousIcon\" data-ipsTooltip title='\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'post_anonymously_reveal', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n'><\/span><\/a>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<div class='ipsPhotoPanel__secondary'>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( ! \\IPS\\Output::i()->reduceLinks() ):\n$return .= <<<IPSCONTENT\n<a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->shareableUrl(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n'>\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n{$comment->dateLine()}\nIPSCONTENT;\n\nif ( ! \\IPS\\Output::i()->reduceLinks() ):\n$return .= <<<IPSCONTENT\n<\/a>\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $comment->editLine() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t(\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edited_lc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n)\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t\nIPSCONTENT;\n\nif ( $comment->author()->hasHighlightedReplies() || ( \\IPS\\IPS::classUsesTrait( $comment, 'IPS\\Content\\Reactable' ) and $comment->isHighlighted() ) OR $comment->isFeatured() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<ul class='ipsBadges'>\n\t\t\t\t\t\nIPSCONTENT;\n\nif ( $comment->author()->hasHighlightedReplies() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t<li><span class='ipsBadge ipsBadge--highlightedGroup'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member\\Group::load( $comment->author()->member_group_id )->name;\n$return .= <<<IPSCONTENT\n<\/span><\/li>\n\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nif ( $comment->isFeatured() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t<li><span class='ipsBadge ipsBadge--positive'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'this_is_a_featured_post', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/span><\/li>\n\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nif ( \\IPS\\IPS::classUsesTrait( $comment, 'IPS\\Content\\Reactable' ) and $comment->isHighlighted() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t<li><span class='ipsBadge ipsBadge--popular'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'this_is_a_popular_comment', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/span><\/li>\n\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<\/ul>\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\nif ( \\count( $item->commentMultimodActions() ) ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<input type=\"checkbox\" name=\"multimod[\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n]\" value=\"1\" data-role=\"moderation\" data-actions=\"\nIPSCONTENT;\n\nif ( $comment->canSplit() ):\n$return .= <<<IPSCONTENT\nsplit merge\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n \nIPSCONTENT;\n\nif ( $comment->hidden() === -1 AND $comment->canUnhide() ):\n$return .= <<<IPSCONTENT\nunhide\nIPSCONTENT;\n\nelseif ( $comment->hidden() === 1 AND $comment->canUnhide() ):\n$return .= <<<IPSCONTENT\napprove\nIPSCONTENT;\n\nelseif ( $comment->canHide() ):\n$return .= <<<IPSCONTENT\nhide\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n \nIPSCONTENT;\n\nif ( $comment->canDelete() ):\n$return .= <<<IPSCONTENT\ndelete\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\" data-state='\nIPSCONTENT;\n\nif ( $comment->tableStates() ):\n$return .= <<<IPSCONTENT\n\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->tableStates(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n' class=\"ipsInput ipsInput--toggle\">\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\n$menu = $comment->menu();\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\nif ( $menu->hasContent() || \\count( $item->commentMultimodActions() ) ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t{$menu}\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\nif ( $comment->author()->member_id ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<!-- Expand mini profile -->\n\t\t\t\t<button class='ipsEntry__topButton ipsEntry__topButton--profile' type='button' aria-controls='mini-profile-\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' aria-expanded='false' data-ipscontrols data-ipscontrols-src=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->authorMiniProfileUrl, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\" aria-label=\"Toggle mini profile\"><i class=\"fa-solid fa-chevron-down\" aria-hidden=\"true\"><\/i><\/button>\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t<\/div>\n        \nIPSCONTENT;\n\nif ( $comment->author()->member_id ):\n$return .= <<<IPSCONTENT\n\n\n        \nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->miniProfileWrap( $comment->author(), $comment->$idField, remoteLoading: true );\n$return .= <<<IPSCONTENT\n\n\n        \nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t<\/header>\n\t<div class='ipsEntry__post'>\n\t\t\n\t\t\nIPSCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->modPermission('mod_see_warn') and $comment->warning ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->commentWarned( $comment );\n$return .= <<<IPSCONTENT\n\n\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\nIPSCONTENT;\n\nif ( $comment->hidden() AND $comment->hidden() != -2 ):\n$return .= <<<IPSCONTENT\n\n\t\t\t<div class='ipsEntry__hiddenMessage'>\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->hiddenBlurb(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n<\/div>\n\t\t\nIPSCONTENT;\n\nelseif ( $comment->hidden() == -2 ):\n$return .= <<<IPSCONTENT\n\n\t\t\t<div class='ipsEntry__hiddenMessage'>\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->deletedBlurb(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n<\/div>\n\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\nIPSCONTENT;\n\nif ( $comment->hidden() === 1 && $comment->author()->member_id == \\IPS\\Member::loggedIn()->member_id ):\n$return .= <<<IPSCONTENT\n\n\t\t\t<div class='i-margin-bottom_3'><strong class='i-color_warning'><i class='fa-solid fa-circle-info'><\/i> \nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'comment_awaiting_approval', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/strong><\/div>\n\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t<div class='ipsRichText ipsRichText--user' data-role='commentContent' data-controller='core.front.core.lightboxedImages'>\n\t\t\t{$comment->content()}\n\t\t\t\nIPSCONTENT;\n\nif ( $comment->editLine() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t{$comment->editLine()}\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t<\/div>\n\t<\/div>\n\t\nIPSCONTENT;\n\nif ( ( $comment->hidden() !== 1 && \\IPS\\IPS::classUsesTrait( $comment, 'IPS\\Content\\Reactable' ) and \\IPS\\Settings::i()->reputation_enabled and $comment->hasReactionBar() ) || ( $comment->hidden() === 1 && ( $comment->canUnhide() || $comment->canDelete() ) ) || ( $comment->hidden() === 0 and $item->canComment() and $editorName )  ):\n$return .= <<<IPSCONTENT\n\n\t\t<div class='ipsEntry__footer'>\n\t\t\t<menu class='ipsEntry__controls' data-role=\"commentControls\">\n\t\t\t\t\nIPSCONTENT;\n\nif ( $comment->hidden() === 1 && ( $comment->canUnhide() || $comment->canDelete() ) ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nif ( $comment->canUnhide() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t<li><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->url('unhide')->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' class='ipsButton ipsButton--small ipsButton--positive' data-action='approveComment'><i class='fa-solid fa-check'><\/i><span>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'approve', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/span><\/a><\/li>\n\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nif ( $comment->canDelete() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t<li><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->url('delete')->csrf()->setPage('page',\\IPS\\Request::i()->page), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-action='deleteComment' data-updateOnDelete=\"#commentCount\"><i class='fa-solid fa-xmark'><\/i><span>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/span><\/a><\/li>\n\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nif ( $comment->canEdit() || $comment->canSplit() || $comment->canHide() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t<a href='#elControlsCommentsSub_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_menu' id='elControlsCommentsSub_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-ipsMenu data-ipsMenu-appendTo='#comment-\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_wrap'><span>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'moderator_tools', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/span><i class='fa-solid fa-caret-down'><\/i><\/a>\n\t\t\t\t\t\t\t<ul id='elControlsCommentsSub_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_menu' class='ipsMenu ipsMenu_auto ipsHide'>\n\t\t\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $comment->canEdit() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $comment->mapped('first') and $comment->item()->canEdit() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->item()->url()->setQueryString( 'do', 'edit' ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\t\nIPSCONTENT;\n\nelse:\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->url('edit'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-action='editComment'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $comment->canSplit() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->url('split'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-action='splitComment' data-ipsDialog data-ipsDialog-title=\"\nIPSCONTENT;\n\n$sprintf = array(\\IPS\\Member::loggedIn()->language()->addToStack( $item::$title )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'split_to_new', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<IPSCONTENT\n\">\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'split', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( \\IPS\\IPS::classUsesTrait( $comment, 'IPS\\Content\\Hideable' ) and $comment->canHide() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->url('hide')->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-ipsDialog data-ipsDialog-title=\"\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'hide', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n\">\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'hide', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nelse:\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nif ( $comment->hidden() === 0 and $item->canComment() and $editorName ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t<li data-ipsQuote-editor='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $editorName, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-ipsQuote-target='#comment-\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' class='ipsJS_show'>\n\t\t\t\t\t\t\t<button class='cMultiQuote ipsHide' data-action='multiQuoteComment' data-ipsTooltip data-ipsQuote-multiQuote data-mqId='mq\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' aria-label='\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'multiquote', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n'><i class='fa-solid fa-plus'><\/i><\/button>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t<li data-ipsQuote-editor='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $editorName, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-ipsQuote-target='#comment-\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' class='ipsJS_show'>\n\t\t\t\t\t\t\t<a href='#' data-action=\"quoteComment\" data-ipsQuote-singleQuote><i class=\"fa-solid fa-quote-left\" aria-hidden=\"true\"><\/i><span>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'quote', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/span><\/a>\n\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nif ( \\IPS\\Application::appIsEnabled('cloud') ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"spam\", \"cloud\" )->spam( $comment, FALSE );\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\t\n\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<li class='ipsHide' data-role='commentLoading'>\n\t\t\t\t\t<span class='ipsLoading ipsLoading--tiny'><\/span>\n\t\t\t\t<\/li>\n\t\t\t<\/menu>\n\t\t\t\nIPSCONTENT;\n\nif ( $comment->hidden() !== 1 && \\IPS\\IPS::classUsesTrait( $comment, 'IPS\\Content\\Reactable' ) and \\IPS\\Settings::i()->reputation_enabled and $comment->hasReactionBar() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->reputation( $comment );\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t<\/div>\n\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\nIPSCONTENT;\n\nif ( ! \\IPS\\Output::i()->reduceLinks() ):\n$return .= <<<IPSCONTENT\n\n    \nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->sharemenu( $comment );\n$return .= <<<IPSCONTENT\n\n    \nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n<\/div>\nIPSCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction commentContainer( $item, $comment, $votes=array(), $otherClasses='' ) {\n\t\t$return = '';\n\t\t$return .= <<<IPSCONTENT\n\n\nIPSCONTENT;\n\n$idField = $comment::$databaseColumnId;\n$return .= <<<IPSCONTENT\n\n\nIPSCONTENT;\n\n$itemClassSafe = str_replace( '\\\\', '_', mb_substr( $comment::$itemClass, 4 ) );\n$return .= <<<IPSCONTENT\n\n\nIPSCONTENT;\n\nif ( $comment->isIgnored() ):\n$return .= <<<IPSCONTENT\n\n\t<div class='ipsEntry ipsEntry--ignored' id='elIgnoreComment_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-ignoreCommentID='elComment_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-ignoreUserID='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->author()->member_id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n'>\n\t\t<i class=\"fa-solid fa-user-slash\"><\/i> \nIPSCONTENT;\n\n$sprintf = array($comment->author()->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ignoring_content', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<IPSCONTENT\n <a href='#elIgnoreComment_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_menu' data-ipsMenu data-ipsMenu-menuID='elIgnoreComment_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_menu' data-ipsMenu-appendTo='#elIgnoreComment_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-action=\"ignoreOptions\" title='\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'see_post_ignore_options', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'options', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n <i class='fa-solid fa-caret-down'><\/i><\/a>\n\t\t<ul class='ipsMenu ipsHide' id='elIgnoreComment_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_menu'>\n\t\t\t<li class='ipsMenu_item' data-ipsMenuValue='showPost'><a href='#'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'show_this_comment', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t<li class='ipsMenu_sep'><hr><\/li>\n\t\t\t<li class='ipsMenu_item' data-ipsMenuValue='stopIgnoring'><a href='\nIPSCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Http\\Url::internal( \"app=core&module=system&controller=ignore&do=remove&id={$comment->author()->member_id}\", null, \"ignore\", array(), 0 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', TRUE );\n$return .= <<<IPSCONTENT\n'>\nIPSCONTENT;\n\n$sprintf = array($comment->author()->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'stop_ignoring_posts_by', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n\n$return .= htmlspecialchars( \\IPS\\Http\\Url::internal( \"app=core&module=system&controller=ignore\", null, \"ignore\", array(), 0 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', TRUE );\n$return .= <<<IPSCONTENT\n'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'change_ignore_preferences', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t<\/ul>\n\t<\/div>\n\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\n<a id='comment-\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n'><\/a>\n<a id='findComment-\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n'><\/a>\n<article id='elComment_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->$idField, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' class=\"ipsEntry js-ipsEntry ipsEntry--simple \nIPSCONTENT;\n\nif ( $otherClasses ):\n$return .= <<<IPSCONTENT\n\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $otherClasses, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n \nIPSCONTENT;\n\nif ( (\\IPS\\IPS::classUsesTrait( $comment, 'IPS\\Content\\Reactable' ) and $comment->isHighlighted()) or $comment->isFeatured() ):\n$return .= <<<IPSCONTENT\nipsEntry--popular\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n \nIPSCONTENT;\n\nif ( $comment->author()->hasHighlightedReplies() ):\n$return .= <<<IPSCONTENT\nipsEntry--highlighted\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n \nIPSCONTENT;\n\nif ( $comment->isIgnored() ):\n$return .= <<<IPSCONTENT\nipsHide\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n \nIPSCONTENT;\n\nif ( $comment->hidden() OR $item->hidden() == -2 ):\n$return .= <<<IPSCONTENT\nipsModerated\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\" \nIPSCONTENT;\n\nif ( $comment->author()->hasHighlightedReplies() ):\n$return .= <<<IPSCONTENT\ndata-memberGroup=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $comment->author()->member_group_id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\"\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n>\n\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"display\", \"cms\", 'database' )->comment( $item, $comment, $item::$formLangPrefix . 'comment', $item::$application, $item::$module, $itemClassSafe );\n$return .= <<<IPSCONTENT\n\n<\/article>\nIPSCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction comments( $record ) {\n\t\t$return = '';\n\t\t$return .= <<<IPSCONTENT\n\n<div data-controller='core.front.core.commentFeed, core.front.core.ignoredComments' \nIPSCONTENT;\n\nif ( \\IPS\\Settings::i()->auto_polling_enabled ):\n$return .= <<<IPSCONTENT\ndata-autoPoll\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n data-commentsType='comments' data-baseURL='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $record->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' \nIPSCONTENT;\n\nif ( $record->isLastPage() ):\n$return .= <<<IPSCONTENT\ndata-lastPage\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n data-feedID='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $record->feedId, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' id='comments'>\n\n\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->featuredComments( $record->featuredComments(), $record->url()->setQueryString('tab', 'comments')->setQueryString('recommended', 'comments'), 'recommended_replies', '__defart_comment', false );\n$return .= <<<IPSCONTENT\n\n\t\n\t<div class='ipsButtonBar ipsButtonBar--top'>\n\t\t\nIPSCONTENT;\n\nif ( $record->commentPageCount() > 1 ):\n$return .= <<<IPSCONTENT\n\n\t\t\t<div class='ipsButtonBar__pagination'>{$record->commentPagination( array('tab') )}<\/div>\n\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t<div class='ipsButtonBar__end'>\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->commentMultimodHeader( $record, '#comments' );\n$return .= <<<IPSCONTENT\n<\/div>\n\t<\/div>\n\n\t<div data-role='commentFeed' data-controller='core.front.core.moderation'>\n\t\t<form action=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $record->url()->csrf()->setQueryString( 'do', 'multimodComment' )->setPage('page',\\IPS\\Request::i()->page), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\" method=\"post\" data-ipsPageAction data-role='moderationTools'>\n\t\t\t\nIPSCONTENT;\n\nif ( \\count( $record->comments( NULL, NULL, 'date', 'asc', NULL, NULL, NULL, NULL, FALSE, isset( \\IPS\\Widget\\Request::i()->showDeleted ) ) ) ):\n$return .= <<<IPSCONTENT\n\n\n\t\t\t\t\t\nIPSCONTENT;\n\n$commentCount=0; $timeLastRead = $record->timeLastRead(); $lined = FALSE;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nforeach ( $record->comments( NULL, NULL, 'date', 'asc', NULL, NULL, NULL, NULL, FALSE, isset( \\IPS\\Widget\\Request::i()->showDeleted ) ) as $comment ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( !$lined and $timeLastRead and $timeLastRead->getTimestamp() < $comment->mapped('date') ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $lined = TRUE and $commentCount ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t<hr class=\"ipsUnreadBar\">\n\t\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\n$commentCount++;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t{$comment->html()}\n\t\t\t\t\t\nIPSCONTENT;\n\nendforeach;\n$return .= <<<IPSCONTENT\n\n\n\n\t\t\t\nIPSCONTENT;\n\nelse:\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<p class='ipsEmptyMessage' data-role='noComments'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'no_comments', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/p>\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->commentMultimod( $record );\n$return .= <<<IPSCONTENT\n\n\t\t<\/form>\n\t<\/div>\n\t\nIPSCONTENT;\n\nif ( $record->commentPageCount() > 1 ):\n$return .= <<<IPSCONTENT\n\n\t\t<div class='ipsButtonBar ipsButtonBar--bottom'>\n\t\t\t<div class='ipsButtonBar__pagination'>{$record->commentPagination( array('tab') )}<\/div>\n\t\t<\/div>\n\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\nIPSCONTENT;\n\nif ( $record->commentForm() || $record->locked() || \\IPS\\Member::loggedin()->restrict_post || \\IPS\\Member::loggedIn()->members_bitoptions['unacknowledged_warnings'] || !\\IPS\\Member::loggedIn()->checkPostsPerDay() ):\n$return .= <<<IPSCONTENT\n\n\t\t<div class='ipsComposeAreaWrapper' data-role='replyArea'>\n\t\t\t\nIPSCONTENT;\n\nif ( $record->commentForm() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nif ( $record->locked() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<p class='ipsComposeArea_warning'><i class='fa-solid fa-circle-info'><\/i> \nIPSCONTENT;\n\n$sprintf = array($record::database()->recordWord(1)); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cms_locked_can_comment', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<IPSCONTENT\n<\/p>\n\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t{$record->commentForm()}\n\t\t\t\nIPSCONTENT;\n\nelse:\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nif ( $record->locked() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"forms\", \"core\", 'front' )->commentUnavailable( 'record_locked_cannot_comment' );\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nelseif ( \\IPS\\Member::loggedin()->restrict_post ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"forms\", \"core\", 'front' )->commentUnavailable( 'restricted_cannot_comment', \\IPS\\Member::loggedIn()->warnings(5,NULL,'rpa'), \\IPS\\Member::loggedIn()->restrict_post );\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nelseif ( \\IPS\\Member::loggedIn()->members_bitoptions['unacknowledged_warnings'] ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"forms\", \"core\", 'front' )->commentUnavailable( 'unacknowledged_warning_cannot_post', \\IPS\\Member::loggedIn()->warnings( 1, FALSE ) );\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nelseif ( !\\IPS\\Member::loggedIn()->checkPostsPerDay() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"forms\", \"core\", 'front' )->commentUnavailable( 'member_exceeded_posts_per_day' );\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t<\/div>\n\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n<\/div>\nIPSCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction commentsAndReviewsTabs( $content, $id ) {\n\t\t$return = '';\n\t\t$return .= <<<IPSCONTENT\n\n<div data-controller='core.front.core.commentsWrapper' data-tabsId='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n'>\n\t{$content}\n<\/div>\nIPSCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction filtersAddComment( $rows ) {\n\t\t$return = '';\n\t\t$return .= <<<IPSCONTENT\n\n\nIPSCONTENT;\n\nforeach ( $rows as $line ):\n$return .= <<<IPSCONTENT\n\n\t<p>{$line}<\/p>\n\nIPSCONTENT;\n\nendforeach;\n$return .= <<<IPSCONTENT\n\nIPSCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction record( $record, $commentsAndReviews, $updateForm=NULL, $nextUnread=NULL ) {\n\t\t$return = '';\n\t\t$return .= <<<IPSCONTENT\n\n\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->assignmentHeader( $record );\n$return .= <<<IPSCONTENT\n\n<section class=\"ipsBox ipsBox--record ipsPull\">\n\t<header class=\"ipsPageHeader ipsPageHeader--database-record\">\n\t\t\nIPSCONTENT;\n\nif ( $record->showRecordImage() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t{$record->coverPhoto()}\n\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t<div class=\"ipsPageHeader__row\">\n\t\t\t<div class='ipsPageHeader__primary'>\n\t\t\t\t<div class='ipsPageHeader__title'>\n\t\t\t\t\t<h1>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $record->canEditTitle() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t<span class='' data-controller=\"core.front.core.moderation\">\n\t\t\t\t\t\t\t\t<span data-role=\"editableTitle\" title='\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'click_hold_edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n'>\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $record->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n<\/span>\n\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nelse:\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t<span class=''>\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $record->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n<\/span>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<\/h1>\n\t\t\t\t\t<div class=\"ipsBadges\">\nIPSCONTENT;\n\nforeach ( $record->badges() as $badge ):\n$return .= <<<IPSCONTENT\n{$badge}\nIPSCONTENT;\n\nendforeach;\n$return .= <<<IPSCONTENT\n<\/div>\n\t\t\t\t<\/div>\n\t\t\t\t\nIPSCONTENT;\n\nif ( $record::database()->options['reviews'] ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<div class=\"ipsPageHeader__rating\">\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\", 'front' )->rating( '', $record->averageReviewRating(), \\IPS\\Settings::i()->reviews_rating_out_of, $record->memberReviewRating() );\n$return .= <<<IPSCONTENT\n <span class='i-color_soft'>(\nIPSCONTENT;\n\n$pluralize = array( $record->record_reviews ); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'num_reviews', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'pluralize' => $pluralize ) );\n$return .= <<<IPSCONTENT\n)<\/span><\/div>\n\t\t\t\t\nIPSCONTENT;\n\nelseif ( $record->container()->allow_rating ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<div class=\"ipsPageHeader__rating\">{$record->rating()}<\/div>\n\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nif ( \\count( $record->tags() ) OR ( $record->canEdit() AND $record::canTag( NULL, $record->container() ) ) ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->tagsWithPrefix( $record->tags(), $record->prefix(), FALSE, FALSE, ( $record->canEdit() AND ( \\count( $record->tags() ) OR $record::canTag( NULL, $record->container() ) ) ) ? $record->url() : NULL );\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t<\/div>\n\t\t\t<div class='ipsButtons'>\n\t\t\t\t\nIPSCONTENT;\n\nif ( !$record->container()->disable_sharelinks ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"sharelinks\", \"core\" )->shareButton( $record );\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nif ( \\IPS\\Application::appIsEnabled('cloud') ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"spam\", \"cloud\" )->spam( $record );\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->follow( 'cms', 'records'.$record::$customDatabaseId, $record->primary_id_field, $record->followersCount() );\n$return .= <<<IPSCONTENT\n\n\t\t\t<\/div>\n\t\t<\/div>\n\t\t<div class=\"ipsPageHeader__row ipsPageHeader__row--footer\">\n\t\t\t<div class='ipsPageHeader__primary'>\n\t\t\t\t<div class='ipsPhotoPanel ipsPhotoPanel--inline'>\n\t\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->userPhoto( $record->author(), 'fluid', $record->warningRef() );\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<div class=\"ipsPhotoPanel__text\">\n\t\t\t\t\t\t<p class=\"ipsPhotoPanel__primary\">\n\t\t\t\t\t\t\t\nIPSCONTENT;\n\n$htmlsprintf = array($record->author()->link( NULL, NULL, $record->isAnonymous() )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'content_record_started_by', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'htmlsprintf' => $htmlsprintf ) );\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $record->isAnonymous() and \\IPS\\Member::loggedIn()->modPermission('can_view_anonymous_posters') ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t<a data-ipsHover data-ipsHover-width=\"370\" data-ipsHover-onClick href=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $record->url( 'reveal' )->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\"><span class=\"cAuthorPane_badge cAuthorPane_badge_small cAuthorPane_badge--anon\" data-ipsTooltip title=\"\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'post_anonymously_reveal', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n\"><\/span><\/a>\n\t\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $record->editLine() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t<span class='i-color_soft i-font-weight_normal'>\n\t\t\t\t\t\t\t\t\t(\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edited_lc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n)\n\t\t\t\t\t\t\t\t<\/span>\n\t\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t<\/p>\n\t\t\t\t\t\t<div class=\"ipsPhotoPanel__secondary\">\nIPSCONTENT;\n\n$val = ( $record->mapped( 'date' ) instanceof \\IPS\\DateTime ) ? $record->mapped( 'date' ) : \\IPS\\DateTime::ts( $record->mapped( 'date' ) );$return .= $val->html();\n$return .= <<<IPSCONTENT\n<\/div>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t<\/div>\n\t<\/header>\n\n\t\nIPSCONTENT;\n\nif ( \\count($record->getMessages()) ):\n$return .= <<<IPSCONTENT\n\n\t\t<div class=\"i-padding_2\">\n\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->contentItemMessages( $record->getMessages(), $record );\n$return .= <<<IPSCONTENT\n\n\t\t<\/div>\n\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\n\t<article>\n\t\t<div class='i-padding_3'>\n\t\t\t\nIPSCONTENT;\n\nif ( \\count($record->customFieldsForDisplay('display_top')) ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<ul class=\"ipsDatabaseFields i-margin-bottom_3\">\n\t\t\t\t\t\nIPSCONTENT;\n\nforeach ( $record->customFieldsForDisplay('display_top') as $fieldId => $fieldValue ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $fieldValue ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t<li>{$fieldValue}<\/li>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nendforeach;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<\/ul>\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t<section class=\"ipsRichText ipsRichText--user\" data-controller='core.front.core.lightboxedImages'>{$record->_content}<\/section>\n\t\t\t\n\t\t\t\nIPSCONTENT;\n\nif ( $record->editLine() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t{$record->editLine()}\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\n\t\t\t\nIPSCONTENT;\n\nif ( $records = $record->getReciprocalItems() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nforeach ( $records as $fieldId => $items ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\n$infoLineShown = FALSE;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<ul class=\"ipsList ipsList--csv i-margin-top_3\">\n\t\t\t\t\t\nIPSCONTENT;\n\nforeach ( $items as $item ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t<li>\nIPSCONTENT;\n\nif ( ! $infoLineShown ):\n$return .= <<<IPSCONTENT\n\nIPSCONTENT;\n\n$infoLineShown=TRUE;\n$return .= <<<IPSCONTENT\n\nIPSCONTENT;\n\n$sprintf = array($item::database()->recordWord(0,TRUE), $record::database()->recordWord(1)); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'records_linking_to_me', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<IPSCONTENT\n: \nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n<a href=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $item->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\">\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $item->_title, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\t\nIPSCONTENT;\n\nendforeach;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<\/ul>\n\t\t\t\t\nIPSCONTENT;\n\nendforeach;\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t<\/div>\n\t\t\nIPSCONTENT;\n\nif ( $bottomFields = $record->customFieldsForDisplay('display_bottom') ):\n$return .= <<<IPSCONTENT\n\n\t\t\t<hr class='ipsHr'>\n\t\t\t<div class=\"ipsRichText ipsRichText--user i-padding_3\" data-controller='core.front.core.lightboxedImages'>\n\t\t\t\nIPSCONTENT;\n\nforeach ( $bottomFields as $fieldId => $fieldValue ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nif ( $fieldValue ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t{$fieldValue}\n\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\nendforeach;\n$return .= <<<IPSCONTENT\n\n\t\t\t<\/div>\n\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\n\t\t<div class='ipsEntry__footer'>\n\t\t\t<menu class='ipsEntry__controls'>\n\t\t\t\t<li>\n\t\t\t\t\t{$record->menu()}\n\t\t\t\t<\/li>\n\t\t\t\t\nIPSCONTENT;\n\nif ( $record->canManageRevisions() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<li><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $record->url('revisions'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' title=\"\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'content_view_revisions', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n\">\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'content_view_revisions', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t<\/menu>\n\t\t\t\nIPSCONTENT;\n\nif ( \\IPS\\IPS::classUsesTrait( $record, 'IPS\\Content\\Reactable' ) and \\IPS\\Settings::i()->reputation_enabled ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->reputation( $record );\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t<\/div>\n\t<\/article>\n<\/section>\n\n<section class='ipsBox ipsBox--pageActions i-padding_2 ipsPull ipsResponsive_showPhone'>\n\t<div class='ipsPageActions'>\n\t\t\nIPSCONTENT;\n\nif ( !$record->container()->disable_sharelinks ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"sharelinks\", \"core\" )->shareButton( $record );\n$return .= <<<IPSCONTENT\n\n\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\nIPSCONTENT;\n\nif ( \\IPS\\Application::appIsEnabled('cloud') ):\n$return .= <<<IPSCONTENT\n\n        \t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"spam\", \"cloud\" )->spam( $record );\n$return .= <<<IPSCONTENT\n\n        \nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->follow( 'cms', 'records'.$record::$customDatabaseId, $record->primary_id_field, $record->followersCount() );\n$return .= <<<IPSCONTENT\n\n\t<\/div>\n<\/section>\n\n<nav class='ipsPager'>\n\t<div class=\"ipsPager_prev\">\n\t\t\nIPSCONTENT;\n\nif ( $record::database()->use_categories ):\n$return .= <<<IPSCONTENT\n\n\t\t\t<a href=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $record->container()->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\" title=\"\nIPSCONTENT;\n\n$sprintf = array($record->container()->_title); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cms_back_to_category_with_title', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<IPSCONTENT\n\" rel=\"up\">\n\t\t\t\t<span class=\"ipsPager_type\">\nIPSCONTENT;\n\n$sprintf = array($record::database()->recordWord( 2 )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cms_back_to_category', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<IPSCONTENT\n<\/span>\n\t\t\t<\/a>\n\t\t\nIPSCONTENT;\n\nelse:\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\n$page = \\IPS\\cms\\Pages\\Page::$currentPage;\n$return .= <<<IPSCONTENT\n\n\t\t\t<a href=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $page->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\" title=\"\nIPSCONTENT;\n\n$sprintf = array($page->_title); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cms_back_to_category_with_title', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<IPSCONTENT\n\" rel=\"up\">\n\t\t\t\t<span class=\"ipsPager_type\">\nIPSCONTENT;\n\n$sprintf = array($record::database()->recordWord( 2 )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cms_back_to_category', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<IPSCONTENT\n<\/span>\n\t\t\t<\/a>\n\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t<\/div>\n\t\nIPSCONTENT;\n\nif ( $nextUnread !== NULL ):\n$return .= <<<IPSCONTENT\n\n\t\t<div class='ipsPager_next'>\n\t\t\t<a href=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $record->url()->setQueryString( array( 'do' => 'nextUnread' ) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\" title='\nIPSCONTENT;\n\n$sprintf = array($record::database()->recordWord( 1 )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cms_view_next_unread_title', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<IPSCONTENT\n'>\n\t\t\t\t<span class=\"ipsPager_type\">\nIPSCONTENT;\n\n$sprintf = array($record::database()->recordWord( 1 )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cms_next_unread_title', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<IPSCONTENT\n<\/span>\n\t\t\t<\/a>\n\t\t<\/div>\n\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n<\/nav>\n\n\nIPSCONTENT;\n\nif ( $commentsAndReviews ):\n$return .= <<<IPSCONTENT\n\n\t<h2 class='ipsHide'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'user_feedback', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/h2>\n\t<div class='ipsBox ipsBox--commentsAndReviews ipsPull' id=\"replies\">\n\t\t{$commentsAndReviews}\n\t<\/div>\n\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\n\nIPSCONTENT;\n\nif ( $updateForm ):\n$return .= <<<IPSCONTENT\n\n\t<div class='ipsBox ipsBox--updateForm ipsPull'>\n\t\t<h2 class='ipsBox__header'>\nIPSCONTENT;\n\n$sprintf = array($record::database()->recordWord( 1 )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'cms_front_update_fields', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<IPSCONTENT\n<\/h2>\n\t\t{$updateForm}\n\t<\/div>\n\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\nIPSCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction recordEditLine( $record ) {\n\t\t$return = '';\n\t\t$return .= <<<IPSCONTENT\n\n\n<p class='i-color_soft i-font-size_-1 ipsEdited' data-excludequote data-el='edited'>\n\t<i class=\"fa-regular fa-pen-to-square i-margin-end_icon\"><\/i> <strong class='i-font-weight_500'>\nIPSCONTENT;\n\n$htmlsprintf = array(\\IPS\\DateTime::ts( $record->record_edit_time )->html(FALSE), htmlspecialchars( $record->record_edit_member_name, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'date_edited', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'htmlsprintf' => $htmlsprintf ) );\n$return .= <<<IPSCONTENT\n<\/strong>\n\t\nIPSCONTENT;\n\nif ( $record->record_edit_reason ):\n$return .= <<<IPSCONTENT\n\n\t\t<br>\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $record->record_edit_reason, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\n\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\nIPSCONTENT;\n\nif ( $record->database()->revisions and \\IPS\\Settings::i()->edit_log == 2 and ( \\IPS\\Settings::i()->edit_log_public or \\IPS\\Member::loggedIn()->modPermission('can_view_editlog') ) ):\n$return .= <<<IPSCONTENT\n\n\t\t<a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $record->url('revisions'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-ipsDialog data-ipsDialog-title=\"\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'content_view_revisions', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n\" title=\"\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'content_edit_view_revisions', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n\">\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'content_edit_view_revisions', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a>\n\t\t\nIPSCONTENT;\n\nif ( !$record->record_edit_show AND \\IPS\\Member::loggedIn()->modPermission('can_view_editlog') ):\n$return .= <<<IPSCONTENT\n\n\t\t\t<br>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'comment_edit_show_anyways', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n\n\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n<\/p>\nIPSCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction review( $item, $review, $editorName, $app, $type ) {\n\t\t$return = '';\n\t\t$return .= <<<IPSCONTENT\n\n<div id='review-\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_wrap' data-controller='core.front.core.comment' data-commentApp='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $app, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-feedid=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->feedId, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\" data-commentType='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $type, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n-review' data-commentID=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\" data-quoteData='\nIPSCONTENT;\n\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( json_encode( array('userid' => $review->author()->member_id, 'username' => $review->author()->name, 'timestamp' => $review->mapped('date'), 'contentapp' => $app, 'contenttype' => $type, 'contentid' => $item->id, 'contentcommentid' => $review->id) ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' class='ipsEntry__content js-ipsEntry__content'\n\nIPSCONTENT;\n\nif ( \\IPS\\IPS::classUsesTrait( $review, 'IPS\\Content\\IntersectionViewTracking' ) AND $hash=$review->getViewTrackingHash() ):\n$return .= <<<IPSCONTENT\n\ndata-view-hash=\"{$hash}\"\ndata-view-tracking-data=\"\nIPSCONTENT;\n\n$return .= base64_encode(json_encode( $review->getViewTrackingData() ));\n$return .= <<<IPSCONTENT\n\"\n\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n>\n\t<header class='ipsEntry__header'>\n\t\t<div class='ipsEntry__header-align'>\n\t\t\t<div class='ipsPhotoPanel'>\n\t\t\t\t<div class='ipsAvatarStack'>\n\t\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->userPhoto( $review->author(), 'fluid', $review->warningRef() );\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nif ( $review->author()->canHaveAchievements() and \\IPS\\core\\Achievements\\Rank::show() and $rank = $review->author()->rank() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t{$rank->html( 'ipsAvatarStack__rank' )}\n\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\t<div class='ipsPhotoPanel__text'>\n\t\t\t\t\t<div class='ipsEntry__username'>\n\t\t\t\t\t\t<h3>\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->userLink( $review->author(), $review->warningRef(), NULL, \\IPS\\IPS::classUsesTrait( $review, 'IPS\\Content\\Anonymous' ) AND $review->isAnonymous() );\n$return .= <<<IPSCONTENT\n<\/h3>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( \\IPS\\IPS::classUsesTrait( $review, 'IPS\\Content\\Anonymous' ) and !$review->isAnonymous() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t<span class='ipsEntry__group'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member\\Group::load( $review->author()->member_group_id )->formattedName;\n$return .= <<<IPSCONTENT\n<\/span>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<\/div>\n\t\t\t\t\t<p class='ipsPhotoPanel__secondary'>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $review->mapped('date') ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\nIPSCONTENT;\n\n$val = ( $review->mapped('date') instanceof \\IPS\\DateTime ) ? $review->mapped('date') : \\IPS\\DateTime::ts( $review->mapped('date') );$return .= $val->html();\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\nelse:\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'unknown_date', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $review->editLine() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t(\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edited_lc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n)\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<\/p>\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\t\nIPSCONTENT;\n\nif ( \\count( $item->reviewMultimodActions() ) ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<input type=\"checkbox\" name=\"multimod[\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n]\" value=\"1\" data-role=\"moderation\" data-actions=\"\nIPSCONTENT;\n\nif ( $review->hidden() === -1 AND $review->canUnhide() ):\n$return .= <<<IPSCONTENT\nunhide\nIPSCONTENT;\n\nelseif ( $review->hidden() === 1 AND $review->canUnhide() ):\n$return .= <<<IPSCONTENT\napprove\nIPSCONTENT;\n\nelseif ( $review->canHide() ):\n$return .= <<<IPSCONTENT\nhide\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n \nIPSCONTENT;\n\nif ( $review->canDelete() ):\n$return .= <<<IPSCONTENT\ndelete\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\" data-state='\nIPSCONTENT;\n\nif ( $review->tableStates() ):\n$return .= <<<IPSCONTENT\n\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->tableStates(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n' class=\"ipsInput ipsInput--toggle\">\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t<a href='#elControlsReviews_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_menu' class='ipsEntry__topButton ipsEntry__topButton--ellipsis' id='elControlsReviews_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' title='\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'more_options', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n' data-ipsMenu data-ipsMenu-appendTo='#review-\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_wrap'><i class='fa-solid fa-ellipsis'><\/i><span class='ipsInvisible'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'more_options', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/span><\/a>\n\t\t\t<ul id='elControlsReviews_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_menu' class='ipsMenu ipsMenu_narrow ipsHide'>\n\t\t\t\t\nIPSCONTENT;\n\nif ( $review->canReportOrRevoke() === TRUE ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<li class='ipsMenu_item'>\n\t\t\t\t\t\t<a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('report'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' \nIPSCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->member_id or \\IPS\\Helpers\\Form\\Captcha::supportsModal() ):\n$return .= <<<IPSCONTENT\ndata-ipsDialog data-ipsDialog-remoteSubmit data-ipsDialog-size='medium' data-ipsDialog-flashMessage='\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'report_submit_success', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n' data-ipsDialog-title=\"\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'report', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n\"\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n data-action='reportComment' title='\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'report', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'report', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a>\n\t\t\t\t\t<\/li>\n\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nif ( ! \\IPS\\Output::i()->reduceLinks() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<li class='ipsMenu_item'>\n\t\t\t\t\t<a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->shareableUrl('review'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' title='\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'share_this_review', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n' data-ipsDialog data-ipsDialog-size='narrow' data-ipsDialog-content='#elShareReview_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_menu' data-ipsDialog-title=\"\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'share_this_review', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n\" id='elShareReview_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-role='shareComment'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'share_this_review', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a>\n\t\t\t\t<\/li>\n                \nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nif ( $review->canEdit() || ( $review->hidden() == -2 AND \\IPS\\Member::loggedIn()->modPermission('can_manage_deleted_content') ) || ( \\IPS\\IPS::classUsesTrait( $review, 'IPS\\Content\\Hideable' ) && ( ( !$review->hidden() and $review->canHide() ) || ( $review->hidden() and $review->canUnhide() ) ) ) || $review->canDelete() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<li class='ipsMenu_sep'><hr><\/li>\n\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\n\t\t\t\t\nIPSCONTENT;\n\nif ( $review->canEdit() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('edit'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-action='editComment'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\n\t\t\t\t\nIPSCONTENT;\n\nif ( $review->hidden() == -2 AND \\IPS\\Member::loggedIn()->modPermission('can_manage_deleted_content') ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('restore')->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-confirm data-confirmSubMessage='\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'restore_as_visible_desc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'restore_as_visible', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('restore')->csrf()->setQueryString( 'restoreAsHidden', 1 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-confirm data-confirmSubMessage='\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'restore_as_hidden_desc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'restore_as_hidden', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('delete')->csrf()->setQueryString( 'immediately', 1 ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-confirm data-confirmSubMessage='\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete_immediately_desc', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete_immediately', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\nIPSCONTENT;\n\nelse:\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nif ( \\IPS\\IPS::classUsesTrait( $review, 'IPS\\Content\\Hideable' ) ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( !$review->hidden() and $review->canHide() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n\nif ( $review::$hideLogKey ):\n$return .= <<<IPSCONTENT\n\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('hide'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\nIPSCONTENT;\n\nelse:\n$return .= <<<IPSCONTENT\n\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('hide')->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n' data-ipsDialog data-ipsDialog-title=\"\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'hide', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n\">\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'hide', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nelseif ( $review->hidden() and $review->canUnhide() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('unhide')->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'unhide', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( \\IPS\\Application::appIsEnabled('cloud') ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t<li>\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"spam\", \"cloud\" )->spam( $review, FALSE );\n$return .= <<<IPSCONTENT\n<\/li>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\t\n\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nif ( $review->canDelete() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('delete')->csrf()->setPage('page',\\IPS\\Request::i()->page), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-action='deleteComment' data-updateOnDelete=\"#reviewCount\">\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t<\/ul>\n\t\t\t\nIPSCONTENT;\n\nif ( $review->author()->member_id ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<!-- Expand mini profile -->\n\t\t\t\t<button class='ipsEntry__topButton ipsEntry__topButton--profile' type='button' aria-controls='mini-profile-review-\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' aria-expanded='false' data-ipscontrols data-ipscontrols-src=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->authorMiniProfileUrl, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\" aria-label=\"Toggle mini profile\"><i class=\"fa-solid fa-chevron-down\" aria-hidden=\"true\"><\/i><\/button>\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t<\/div>\n        \nIPSCONTENT;\n\nif ( $review->author()->member_id ):\n$return .= <<<IPSCONTENT\n\n            \nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->miniProfileWrap( $review->author(), $review->id, 'review', remoteLoading: true );\n$return .= <<<IPSCONTENT\n\n        \nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t<\/header>\n\t<div class='ipsEntry__post'>\n\t\t\nIPSCONTENT;\n\nif ( $review->hidden() AND $review->hidden() != -2 ):\n$return .= <<<IPSCONTENT\n\n\t\t\t<div class='ipsEntry__hiddenMessage'>\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->hiddenBlurb(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n<\/div>\n\t\t\nIPSCONTENT;\n\nelseif ( $review->hidden() == -2 ):\n$return .= <<<IPSCONTENT\n\n\t\t\t<div class='ipsEntry__hiddenMessage'>\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->deletedBlurb(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n<\/div>\n\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t<div class='ipsRating ipsRating_large i-margin-bottom_3'>\n\t\t\t<ul>\n\t\t\t\t\nIPSCONTENT;\n\nforeach ( range( 1, \\intval( \\IPS\\Settings::i()->reviews_rating_out_of ) ) as $i ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<li class='\nIPSCONTENT;\n\nif ( $review->mapped('rating') >= $i ):\n$return .= <<<IPSCONTENT\nipsRating_on\nIPSCONTENT;\n\nelse:\n$return .= <<<IPSCONTENT\nipsRating_off\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n'>\n\t\t\t\t\t\t<i class='fa-solid fa-star'><\/i>\n\t\t\t\t\t<\/li>\n\t\t\t\t\nIPSCONTENT;\n\nendforeach;\n$return .= <<<IPSCONTENT\n\n\t\t\t<\/ul>\n\t\t<\/div>\n\t\t&nbsp;&nbsp; \nIPSCONTENT;\n\nif ( $review->mapped('votes_total') ):\n$return .= <<<IPSCONTENT\n<strong>{$review->helpfulLine()}<\/strong>\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\n\t\t<div id=\"review-\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\" class='ipsRichText ipsRichText--user' data-role='commentContent' data-controller='core.front.core.lightboxedImages'>\n\t\t\t{$review->content()}\n\t\t\t\nIPSCONTENT;\n\nif ( $review->editLine() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t{$review->editLine()}\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t<\/div>\n\n\t\t\nIPSCONTENT;\n\nif ( $review->hasAuthorResponse() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t<div class='ipsReviewResponse i-padding_3 i-margin-bottom_3 i-background_2'>\n\t\t\t\t<div class='i-flex i-align-items_center i-justify-content_space-between i-margin-bottom_2'>\n\t\t\t\t\t<h4 class='ipsTitle ipsTitle--h5'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'review_response_title', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/h4>\n\t\t\t\t\t\nIPSCONTENT;\n\nif ( $review->canEditResponse() OR $review->canDeleteResponse() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t<a href='#elControlsReviews_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_response_menu' class='ipsEntry__topButton ipsEntry__topButton--ellipsis' id='elControlsReviews_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_response' title='\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'more_options', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n' data-ipsMenu data-ipsMenu-appendTo='#review-\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_wrap'><i class='fa-solid fa-ellipsis'><\/i><\/a>\n\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<\/div>\n\t\t\t\t<div data-role=\"reviewResponse\" class=\"ipsRichText\" data-controller='core.front.core.lightboxedImages'>{$review->mapped('author_response')}<\/div>\n\n\t\t\t\t\nIPSCONTENT;\n\nif ( $review->canEditResponse() OR $review->canDeleteResponse() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<ul class='ipsMenu ipsMenu_narrow ipsHide' id='elControlsReviews_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_response_menu'>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $review->canEditResponse() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('editResponse'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-ipsDialog data-ipsDialog-title='\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'review_author_respond', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $review->canDeleteResponse() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('deleteResponse')->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-confirm>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<\/ul>\n\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t<\/div>\n\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\n\t\t\nIPSCONTENT;\n\nif ( $review->hidden() !== 1 ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->member_id and ( !$review->mapped('votes_data') or !array_key_exists( \\IPS\\Member::loggedIn()->member_id, json_decode( $review->mapped('votes_data'), TRUE ) ) ) and $review->author()->member_id != \\IPS\\Member::loggedIn()->member_id ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<div class='i-flex i-align-items_center i-flex-wrap_wrap i-gap_2 i-margin-top_3'>\n\t\t\t\t\t<div class='i-font-weight_500 i-color_hard i-font-size_-1'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'did_you_find_this_helpful', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/div>\n\t\t\t\t\t<div class='ipsButtons i-font-size_-2'>\n\t\t\t\t\t\t<a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('rate')->setQueryString( 'helpful', TRUE )->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' class='ipsButton ipsButton--inherit i-color_positive' data-action=\"rateReview\"><i class='fa-solid fa-check'><\/i><span>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'yes', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/span><\/a>\n\t\t\t\t\t\t<a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('rate')->setQueryString( 'helpful', FALSE )->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' class='ipsButton ipsButton--inherit i-color_negative' data-action=\"rateReview\"><i class='fa-solid fa-xmark'><\/i><span>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'no', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/span><\/a>\n\t\t\t\t\t<\/div>\n\t\t\t\t<\/div>\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t<\/div>\n\n\t\nIPSCONTENT;\n\nif ( ( \\IPS\\Member::loggedIn()->member_id and ( !$review->mapped('votes_data') or !array_key_exists( \\IPS\\Member::loggedIn()->member_id, json_decode( $review->mapped('votes_data'), TRUE ) ) ) ) || $review->canEdit() || $review->canDelete() || $review->canHide() || $review->canUnhide() || ( $review->hidden() !== 1 && \\IPS\\IPS::classUsesTrait( $review, 'IPS\\Content\\Reactable' ) and \\IPS\\Settings::i()->reputation_enabled and $review->hasReactionBar() ) ):\n$return .= <<<IPSCONTENT\n\n\t\t<div class='ipsEntry__footer'>\n\t\t\t\nIPSCONTENT;\n\nif ( $review->canEdit() || $review->canDelete() || $review->canHide() || $review->canUnhide() || ( $review->hidden() !== 1 && $review->canRespond() )  ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<menu class='ipsEntry__controls' data-role=\"commentControls\">\n\t\t\t\t\t\nIPSCONTENT;\n\nif ( $review->hidden() === 1 && ( $review->canUnhide() || $review->canDelete() ) ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $review->canUnhide() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t<li><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('unhide')->csrf(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-action='approveComment'><i class='fa-solid fa-check'><\/i><span>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'approve', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/span><\/a><\/li>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $review->canDelete() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t<li><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('delete')->csrf()->setPage('page',\\IPS\\Request::i()->page), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-action='deleteComment' data-updateOnDelete=\"#commentCount\"><i class='fa-solid fa-xmark'><\/i><span>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'delete', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/span><\/a><\/li>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $review->canEdit() || $review->canSplit() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t<li>\n\t\t\t\t\t\t\t\t<a href='#elControlsReviewsSub_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_menu' id='elControlsReviewsSub_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-ipsMenu data-ipsMenu-appendTo='#review-\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_wrap'><span>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'options', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/span><i class='fa-solid fa-caret-down'><\/i><\/a>\n\t\t\t\t\t\t\t\t<ul id='elControlsReviewsSub_\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n_menu' class='ipsMenu ipsMenu_narrow ipsHide'>\n\t\t\t\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $review->canEdit() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $review->mapped('first') and $review->item()->canEdit() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->item()->url()->setQueryString( 'do', 'edit' ), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\t\t\nIPSCONTENT;\n\nelse:\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('edit'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-action='editComment'>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'edit', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $review->canSplit() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t\t\t<li class='ipsMenu_item'><a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('split'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-action='splitComment' data-ipsDialog data-ipsDialog-title=\"\nIPSCONTENT;\n\n$sprintf = array(\\IPS\\Member::loggedIn()->language()->addToStack( $item::$title )); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'split_to_new', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<IPSCONTENT\n\">\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'split', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a><\/li>\n\t\t\t\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t\t<\/ul>\n\t\t\t\t\t\t\t<\/li>\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nelseif ( $review->hidden() !== 1 && $review->canRespond() ):\n$return .= <<<IPSCONTENT\n\n                        <li>\n                            <a href='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->url('respond'), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' data-role='respond' data-ipsDialog data-ipsDialog-title='\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'review_author_respond', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n'><span>\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'review_author_respond', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/span><\/a>\n                        <\/li>\n\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t<li class='ipsHide' data-role='commentLoading'>\n\t\t\t\t\t\t<span class='ipsLoading ipsLoading--tiny'><\/span>\n\t\t\t\t\t<\/li>\n\t\t\t\t<\/menu>\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\nif ( $review->hidden() !== 1 && \\IPS\\IPS::classUsesTrait( $review, 'IPS\\Content\\Reactable' ) and \\IPS\\Settings::i()->reputation_enabled ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->reputation( $review );\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t<\/div>\n\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\nIPSCONTENT;\n\nif ( ! \\IPS\\Output::i()->reduceLinks() ):\n$return .= <<<IPSCONTENT\n\n\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->sharemenu( $review );\n$return .= <<<IPSCONTENT\n\n\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n<\/div>\nIPSCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction reviewContainer( $item, $review ) {\n\t\t$return = '';\n\t\t$return .= <<<IPSCONTENT\n\n\nIPSCONTENT;\n\nif ( $review->isIgnored() ):\n$return .= <<<IPSCONTENT\n\n\t<div class='ipsEntry ipsEntry--ignored'>\n\t\t<i class=\"fa-solid fa-user-slash\"><\/i> \nIPSCONTENT;\n\n$sprintf = array($review->author()->name); $return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'ignoring_content', ENT_DISALLOWED, 'UTF-8', FALSE ), FALSE, array( 'sprintf' => $sprintf ) );\n$return .= <<<IPSCONTENT\n\n\t<\/div>\n\nIPSCONTENT;\n\nelse:\n$return .= <<<IPSCONTENT\n\n\t<a id=\"review-\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\"><\/a>\n\t<a id=\"findReview-\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\"><\/a>\n\t<article id=\"review-\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $review->id, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\" class=\"ipsEntry js-ipsEntry ipsEntry--simple ipsEntry--review \nIPSCONTENT;\n\nif ( $review->hidden() OR $item->hidden() == -2 ):\n$return .= <<<IPSCONTENT\nipsModerated\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\">\n\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"display\", \"cms\", 'database' )->review( $item, $review, $item::$formLangPrefix . 'review', $item::$application, $item::$module );\n$return .= <<<IPSCONTENT\n\n\t<\/article>\n\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\nIPSCONTENT;\n\n\t\treturn $return;\n}\n\n\tfunction reviews( $record ) {\n\t\t$return = '';\n\t\t$return .= <<<IPSCONTENT\n\n<div data-controller='core.front.core.commentFeed' \nIPSCONTENT;\n\nif ( \\IPS\\Settings::i()->auto_polling_enabled ):\n$return .= <<<IPSCONTENT\ndata-autoPoll\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n data-commentsType='reviews' data-baseURL='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $record->url(), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' \nIPSCONTENT;\n\nif ( $record->isLastPage('reviews') ):\n$return .= <<<IPSCONTENT\ndata-lastPage\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n data-feedID='\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $record->reviewFeedId, ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n' id='reviews'>\n\t\nIPSCONTENT;\n\nif ( $record->reviewForm() ):\n$return .= <<<IPSCONTENT\n\n\t\t<div class=\"ipsComposeAreaWrapper\">\n\t\t\t\nIPSCONTENT;\n\nif ( $record->locked() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<strong class='i-color_warning'><i class='fa-solid fa-circle-info'><\/i> \nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'item_locked_can_review', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/strong>\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t<div id='elRecordReviewForm'>\n\t\t\t\t{$record->reviewForm()}\n\t\t\t<\/div>\n\t\t<\/div>\n\t\nIPSCONTENT;\n\nelse:\n$return .= <<<IPSCONTENT\n\n\t\t\nIPSCONTENT;\n\nif ( $record->hasReviewed() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t<!-- Already reviewed -->\n\t\t\nIPSCONTENT;\n\nelseif ( $record->locked() ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"forms\", \"core\", 'front' )->commentUnavailable( 'item_locked_cannot_review' );\n$return .= <<<IPSCONTENT\n\n\t\t\nIPSCONTENT;\n\nelseif ( \\IPS\\Member::loggedin()->restrict_post ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\nif ( \\IPS\\Member::loggedIn()->restrict_post == -1 ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"forms\", \"core\", 'front' )->reviewUnavailable( 'restricted_cannot_comment' );\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\nelse:\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"forms\", \"core\", 'front' )->reviewUnavailable( 'restricted_cannot_comment', \\IPS\\Member::loggedIn()->warnings(5,NULL,'rpa'), \\IPS\\Member::loggedIn()->restrict_post );\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\nIPSCONTENT;\n\nelseif ( \\IPS\\Member::loggedIn()->members_bitoptions['unacknowledged_warnings'] ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"forms\", \"core\", 'front' )->reviewUnavailable( 'unacknowledged_warning_cannot_post', \\IPS\\Member::loggedIn()->warnings( 1, FALSE ) );\n$return .= <<<IPSCONTENT\n\n\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\nIPSCONTENT;\n\nif ( \\count( $record->reviews( NULL, NULL, 'date', 'desc', NULL, NULL, NULL, NULL, isset( \\IPS\\Widget\\Request::i()->showDeleted ) ) ) ):\n$return .= <<<IPSCONTENT\n\n\t\t<div class=\"ipsButtonBar ipsButtonBar--top\">\n\t\t\t\nIPSCONTENT;\n\nif ( $record->reviewPageCount() > 1 ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t<div class=\"ipsButtonBar__pagination\">\n\t\t\t\t\t{$record->reviewPagination( array( 'tab', 'sort' ) )}\n\t\t\t\t<\/div>\n\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t<div class='ipsButtonBar__end'>\n\t\t\t\t<ul class='ipsDataFilters'>\n\t\t\t\t\t<li data-action=\"tableFilter\">\n\t\t\t\t\t\t<a href=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $record->url()->setQueryString( array( 'd' => $record::$customDatabaseId, 'tab' => 'reviews', 'sort' => 'helpful' ) )->setPage('page',1), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\" class=\"ipsDataFilters__button \nIPSCONTENT;\n\nif ( !isset( \\IPS\\Widget\\Request::i()->sort ) or \\IPS\\Widget\\Request::i()->sort != 'newest' ):\n$return .= <<<IPSCONTENT\nipsDataFilters__button--active\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\" data-action=\"filterClick\">\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'most_helpful', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a>\n\t\t\t\t\t<\/li>\n\t\t\t\t\t<li data-action=\"tableFilter\">\n\t\t\t\t\t\t<a href=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $record->url()->setQueryString( array( 'd' => $record::$customDatabaseId, 'tab' => 'reviews', 'sort' => 'newest' ) )->setPage('page',1), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\" class=\"ipsDataFilters__button \nIPSCONTENT;\n\nif ( isset( \\IPS\\Widget\\Request::i()->sort ) and \\IPS\\Widget\\Request::i()->sort == 'newest' ):\n$return .= <<<IPSCONTENT\nipsDataFilters__button--active\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\" data-action=\"filterClick\">\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'newest', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/a>\n\t\t\t\t\t<\/li>\n\t\t\t\t<\/ul>\n\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->commentMultimodHeader( $record, '#reviews', 'review' );\n$return .= <<<IPSCONTENT\n\n\t\t\t<\/div>\n\t\t<\/div>\t\t\n\t\t<div data-role='commentFeed' data-controller='core.front.core.moderation'>\n\t\t\t<form action=\"\nIPSCONTENT;\n$return .= \\IPS\\Theme\\Template::htmlspecialchars( $record->url()->csrf()->setQueryString( 'do', 'multimodReview' )->setPage('page',\\IPS\\Request::i()->page), ENT_QUOTES | ENT_DISALLOWED, 'UTF-8', FALSE );\n$return .= <<<IPSCONTENT\n\" method=\"post\" data-ipsPageAction data-role='moderationTools'>\n\t\t\t\t\nIPSCONTENT;\n\n$reviewCount=0; $timeLastRead = $record->timeLastRead(); $lined = FALSE;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\nforeach ( $record->reviews( NULL, NULL, 'date', 'desc', NULL, NULL, NULL, NULL, isset( \\IPS\\Widget\\Request::i()->showDeleted ) ) as $review ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nif ( !$lined and $timeLastRead and $timeLastRead->getTimestamp() < $review->mapped('date') ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\nIPSCONTENT;\n\nif ( $lined = TRUE and $reviewCount ):\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\t\t<hr class=\"ipsUnreadBar\">\n\t\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t\nIPSCONTENT;\n\n$reviewCount++;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\t{$review->html()}\n\t\t\t\t\nIPSCONTENT;\n\nendforeach;\n$return .= <<<IPSCONTENT\n\n\t\t\t\t\nIPSCONTENT;\n\n$return .= \\IPS\\cms\\Theme::i()->getTemplate( \"global\", \"core\" )->commentMultimod( $record, 'review' );\n$return .= <<<IPSCONTENT\n\n\t\t\t<\/form>\n\t\t<\/div>\n\t\t\nIPSCONTENT;\n\nif ( $record->reviewPageCount() > 1 ):\n$return .= <<<IPSCONTENT\n\n\t\t\t<div class=\"ipsButtonBar ipsButtonBar--bottom\">\n\t\t\t\t<div class=\"ipsButtonBar__pagination\">\n\t\t\t\t\t{$record->reviewPagination( array( 'tab', 'sort' ) )}\n\t\t\t\t<\/div>\n\t\t\t<\/div>\n\t\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n\t\nIPSCONTENT;\n\nelseif ( !$record->canReview() ):\n$return .= <<<IPSCONTENT\n\n\t\t<p class=\"ipsEmptyMessage\" data-role=\"noReviews\">\nIPSCONTENT;\n\n$return .= \\IPS\\Member::loggedIn()->language()->addToStack( htmlspecialchars( 'no_reviews', ENT_DISALLOWED, 'UTF-8', FALSE ), TRUE, array(  ) );\n$return .= <<<IPSCONTENT\n<\/p>\n\t\nIPSCONTENT;\n\nendif;\n$return .= <<<IPSCONTENT\n\n<\/div>\nIPSCONTENT;\n\n\t\treturn $return;\n}}"
VALUE;
